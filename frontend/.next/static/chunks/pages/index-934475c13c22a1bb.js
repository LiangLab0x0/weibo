(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(6871)}])},6871:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return A}});var a=s(5893),n=s(7294),r=s(1581),i=s(7259),l=s(2502),c=s(4073),o=s(3357),d=s(284),u=s(5764),x=s(2213),h=s(2162),p=s(9770),j=s(8616),Z=s(7003),g=s(4579),y=s(4938),m=s(2930),_=s(6073),k=s(494),w=s(1433),S=s(7170),f=s(3610),P=s(818),v=s(5738),R=s(8776),C=s(5121);let E=s(3454).env.NEXT_PUBLIC_API_URL||"/api/v1",I=C.Z.create({baseURL:E,timeout:3e4,headers:{"Content-Type":"application/json"}});I.interceptors.request.use(e=>e,e=>Promise.reject(e)),I.interceptors.response.use(e=>e,e=>{var t,s;let a=(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||e.message||"请求失败";return u.ZP.error(a),Promise.reject(e)});var b={analyzeContent:async e=>(await I.post("/weibo/analyze",e)).data,deletePosts:async e=>(await I.post("/weibo/delete",e)).data,getTaskStatus:async e=>(await I.get("/weibo/task/".concat(e))).data,cancelTask:async e=>(await I.delete("/weibo/task/".concat(e))).data,getStats:async()=>(await I.get("/weibo/stats")).data};let{Step:T}=r.default,{RangePicker:F}=i.default,{TextArea:U}=l.default,{Title:O,Text:Y}=c.default,{confirm:z}=o.default;var A=()=>{let[e,t]=(0,n.useState)(0),[s]=d.Z.useForm(),[i,l]=(0,n.useState)(!1),[c,o]=(0,n.useState)(null),[C,E]=(0,n.useState)(null),[I,A]=(0,n.useState)([]),[L,G]=(0,n.useState)([]),[N,B]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=null;return(null==c?void 0:c.task_id)&&"PROGRESS"===c.status&&(e=setInterval(async()=>{try{let s=await b.getTaskStatus(c.task_id);if(o(s),"SUCCESS"===s.status){var e;A((null===(e=s.result)||void 0===e?void 0:e.analyzed_posts)||[]),t(2),u.ZP.success("分析完成！")}else"FAILURE"===s.status&&u.ZP.error("分析失败: ".concat(s.error))}catch(e){console.error("获取任务状态失败:",e)}},2e3)),(null==C?void 0:C.task_id)&&"PROGRESS"===C.status&&(e=setInterval(async()=>{try{let e=await b.getTaskStatus(C.task_id);E(e),"SUCCESS"===e.status?(t(3),u.ZP.success("删除完成！")):"FAILURE"===e.status&&u.ZP.error("删除失败: ".concat(e.error))}catch(e){console.error("获取任务状态失败:",e)}},2e3)),()=>{e&&clearInterval(e)}},[c,C]),(0,n.useEffect)(()=>{(async()=>{try{let e=await b.getStats();B(e)}catch(e){console.error("获取统计信息失败:",e)}})()},[]);let D=async e=>{try{l(!0);let s={time_range:e.dateRange?{start_date:e.dateRange[0].format("YYYY-MM-DD"),end_date:e.dateRange[1].format("YYYY-MM-DD")}:void 0,keywords:e.keywords?e.keywords.split("\n").filter(Boolean):[],max_posts:e.maxPosts||100},a=await b.analyzeContent(s);o({task_id:a.task_id,status:"PROGRESS",message:a.message}),t(1),u.ZP.success("分析任务已创建")}catch(e){u.ZP.error("创建分析任务失败")}finally{l(!1)}},M=async e=>{try{await b.cancelTask(e),u.ZP.success("任务已取消"),(null==c?void 0:c.task_id)===e&&o(null),(null==C?void 0:C.task_id)===e&&E(null)}catch(e){u.ZP.error("取消任务失败")}},X=()=>{t(0),o(null),E(null),A([]),G([]),s.resetFields()},K=e=>e>=7?(0,a.jsx)(x.Z,{color:"red",children:"高风险"}):e>=4?(0,a.jsx)(x.Z,{color:"orange",children:"中风险"}):(0,a.jsx)(x.Z,{color:"green",children:"低风险"}),W=[{title:"微博ID",dataIndex:"post_id",key:"post_id",width:120,ellipsis:!0},{title:"内容摘要",dataIndex:"content",key:"content",ellipsis:!0,render:e=>(0,a.jsx)(Y,{ellipsis:{tooltip:e},style:{maxWidth:300},children:e})},{title:"发布日期",dataIndex:"date",key:"date",width:120},{title:"风险分数",dataIndex:"risk_score",key:"risk_score",width:100,render:e=>(0,a.jsxs)(h.Z,{children:[(0,a.jsx)("span",{children:e.toFixed(1)}),K(e)]}),sorter:(e,t)=>t.risk_score-e.risk_score},{title:"风险原因",dataIndex:"risk_reason",key:"risk_reason",ellipsis:!0}];return(0,a.jsxs)("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[(0,a.jsx)(O,{level:2,children:"微博AI内容管理器"}),N&&(0,a.jsxs)(p.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,a.jsx)(j.Z,{span:6,children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(g.Z,{title:"活跃任务",value:N.active_tasks})})}),(0,a.jsx)(j.Z,{span:6,children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(g.Z,{title:"等待任务",value:N.reserved_tasks})})}),(0,a.jsx)(j.Z,{span:6,children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(g.Z,{title:"每小时删除限制",value:N.max_delete_per_hour})})}),(0,a.jsx)(j.Z,{span:6,children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(g.Z,{title:"操作延迟",value:N.operation_delay_range,formatter:e=>(0,a.jsx)("span",{children:e})})})})]}),(0,a.jsxs)(r.default,{current:e,style:{marginBottom:"24px"},children:[(0,a.jsx)(T,{title:"设置条件",description:"配置分析参数"}),(0,a.jsx)(T,{title:"分析进度",description:"AI正在分析内容"}),(0,a.jsx)(T,{title:"查看结果",description:"选择要删除的微博"}),(0,a.jsx)(T,{title:"删除完成",description:"查看删除结果"})]}),0===e&&(0,a.jsx)(Z.Z,{title:"设置分析条件",children:(0,a.jsxs)(d.Z,{form:s,layout:"vertical",onFinish:D,children:[(0,a.jsx)(d.Z.Item,{name:"dateRange",label:"时间范围",tooltip:"选择要分析的微博发布时间范围",children:(0,a.jsx)(F,{style:{width:"100%"},placeholder:["开始日期","结束日期"]})}),(0,a.jsx)(d.Z.Item,{name:"keywords",label:"关键词过滤",tooltip:"每行一个关键词，留空则分析所有微博",children:(0,a.jsx)(U,{rows:4,placeholder:"输入关键词，每行一个 例如： 政治 敏感词 个人信息"})}),(0,a.jsx)(d.Z.Item,{name:"maxPosts",label:"最大分析数量",initialValue:100,children:(0,a.jsx)(y.Z,{min:1,max:1e3,style:{width:"100%"}})}),(0,a.jsx)(d.Z.Item,{children:(0,a.jsx)(m.ZP,{type:"primary",htmlType:"submit",loading:i,icon:(0,a.jsx)(f.Z,{}),size:"large",children:"开始分析"})})]})}),1===e&&c&&(0,a.jsx)(Z.Z,{title:"分析进度",children:(0,a.jsxs)(h.Z,{direction:"vertical",style:{width:"100%"},children:[(0,a.jsx)(_.Z,{percent:c.progress||0,status:"FAILURE"===c.status?"exception":"active"}),(0,a.jsx)(Y,{children:c.message}),"PROGRESS"===c.status&&(0,a.jsx)(m.ZP,{danger:!0,icon:(0,a.jsx)(P.Z,{}),onClick:()=>M(c.task_id),children:"取消任务"})]})}),2===e&&(0,a.jsx)(Z.Z,{title:"分析结果",extra:(0,a.jsxs)(h.Z,{children:[(0,a.jsx)(m.ZP,{icon:(0,a.jsx)(v.Z,{}),onClick:X,children:"重新分析"}),(0,a.jsxs)(m.ZP,{type:"primary",danger:!0,icon:(0,a.jsx)(R.Z,{}),onClick:()=>{if(0===L.length){u.ZP.warning("请选择要删除的微博");return}z({title:"确认删除",icon:(0,a.jsx)(S.Z,{}),content:"确定要删除选中的 ".concat(L.length," 条微博吗？此操作不可撤销。"),okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{l(!0);let e=await b.deletePosts({post_ids:L,confirm:!0});E({task_id:e.task_id,status:"PROGRESS",message:e.message}),u.ZP.success("删除任务已创建")}catch(e){u.ZP.error("创建删除任务失败")}finally{l(!1)}}})},disabled:0===L.length,loading:i,children:["删除选中 (",L.length,")"]})]}),children:I.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{message:"共分析 ".concat(I.length," 条微博"),description:"高风险: ".concat(I.filter(e=>e.risk_score>=7).length," 条，中风险: ").concat(I.filter(e=>e.risk_score>=4&&e.risk_score<7).length," 条，低风险: ").concat(I.filter(e=>e.risk_score<4).length," 条"),type:"info",style:{marginBottom:"16px"}}),(0,a.jsx)(w.Z,{columns:W,dataSource:I,rowKey:"post_id",rowSelection:{selectedRowKeys:L,onChange:e=>G(e),getCheckboxProps:e=>({name:e.post_id})},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>"第 ".concat(t[0],"-").concat(t[1]," 条，共 ").concat(e," 条")}})]}):(0,a.jsx)(k.Z,{message:"未找到符合条件的微博",description:"请调整分析条件后重试",type:"warning"})}),3===e&&C&&(0,a.jsx)(Z.Z,{title:"删除结果",children:(0,a.jsxs)(h.Z,{direction:"vertical",style:{width:"100%"},children:["PROGRESS"===C.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{percent:C.progress||0,status:"active"}),(0,a.jsx)(Y,{children:C.message}),(0,a.jsx)(m.ZP,{danger:!0,icon:(0,a.jsx)(P.Z,{}),onClick:()=>M(C.task_id),children:"取消删除"})]}),"SUCCESS"===C.status&&C.result&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{message:"删除完成",description:"成功删除 ".concat(C.result.successful_count," 条，失败 ").concat(C.result.failed_count," 条"),type:"success"}),(0,a.jsx)(m.ZP,{type:"primary",onClick:X,children:"重新开始"})]}),"FAILURE"===C.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{message:"删除失败",description:C.error,type:"error"}),(0,a.jsx)(m.ZP,{onClick:X,children:"重新开始"})]})]})})]})}}},function(e){e.O(0,[23,967,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);